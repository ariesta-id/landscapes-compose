#!/bin/bash
set -euo pipefail

export VERSION=`git describe --tags | cut -c2-`

if ! [ -f ".env" ]; then
  read -p "Enter your domain name, e.g. your-university.ac.uk [localhost]: " ADDRESS
  read -p "Enter your landscape modelling tool subdomain name, e.g. landscapes: " LMTSUBDOM
  read -p "Enter your annotation tool subdomain name, e.g. annotations: " ANNOSUBDOM
  export ADDRESS="${ADDRESS:-localhost}"
  export LMTSUBDOM="${LMTSUBDOM}"
  export ANNOSUBDOM="${ANNOSUBDOM}"
  export LMTADDRESS="${LMTSUBDOM}.${ADDRESS}"
  export ANNOADDRESS="${ANNOSUBDOM}.${ADDRESS}"
  echo "ADDRESS=$ADDRESS" > .env
  echo "LMTSUBDOM=$LMTSUBDOM" >> .env
  echo "ANNOSUBDOM=$ANNOSUBDOM" >> .env
  echo "LMTADDRESS=$LMTADDRESS" >> .env
  echo "ANNOADDRESS=$ANNOADDRESS" >> .env
  echo "VERSION=$VERSION" >> .env
fi

envsubst < "docker-compose.yml" | docker-compose -f - up -d

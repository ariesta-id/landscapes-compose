<%=
  form_with(
    model: [@team, @project],
    html: {
      data: {
        controller: "form",
        action: "ajax:error->form#onError",
      }
    }
  ) do |form|
%>
  <div class="form-group">
    <%= form.label :name %>
    <span data-form-target="error" data-field="name"></span>
    <%= form.text_field :name, class: 'form-control', data: { "form-target": "field", field: "name" }, placeholder: "Project name" %>
  </div>

  <div class="form-group" id="PROJEDIT3303">
    <%= form.label :extent %>
    <span data-form-target="error" data-field="extent"></span>
    <br>

    <div class="row">
      <div class="col">
        <%= form.text_field :extent, class: 'form-control', data: { "form-target": "field", field: "extent" } %>  
      </div>
      <div class="col-3" style="padding-left: 1px">
        <%= form.collection_select :value, @extents.order(:name), :value, :name, { include_blank: true }, { style: "width: 100%; height: 100%;" } %>
      </div>
    </div>

    <span id="zoom" class="badge"></span>
  </div>

  <div id="map" style="width: 100%; height: 400px; margin-bottom: 10px;"></div>
  
  <div id="guide" style="margin-bottom: 10px">
  </div>

  <%= form.submit "Save", class: "btn btn-primary" %>
  <%= link_to "Cancel", [@team, :projects], class: "btn btn-secondary" %>

  

<% end %>

<script>

    function updateExtentVals(){
        const value = document.getElementById('project_value').value
        const extent = value ? value.split('[')[1].split(']')[0].split(',').map(Number) : [-49469.089243, 6570068.329224, 55641.379277, 6669018.450996]
        document.getElementById('project_extent').value = extent.join(', ')
        mapUpdate('PROJEDIT3303')
    }

    document.addEventListener("turbolinks:load", () => mapUpdate('PROJEDIT3303'))

    document.getElementById('project_value').addEventListener('change', () => {
        const value = document.getElementById('project_value').value
        const extent = value ? value.split('[')[1].split(']')[0].split(',').map(Number) : [-49469.089243, 6570068.329224, 55641.379277, 6669018.450996]
        document.getElementById('project_extent').value = extent.join(', ')
        mapUpdate('PROJEDIT3303')
    })

    document.getElementById('project_extent').addEventListener('change', () => {
        document.getElementById('project_value').value = ""
    })

    updateExtentVals()

</script>

